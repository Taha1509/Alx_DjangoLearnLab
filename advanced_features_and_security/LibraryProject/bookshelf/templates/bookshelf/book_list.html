<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book List</title>
    <style>
        .book-list { margin: 20px 0; }
        .book-item { 
            padding: 10px; 
            border: 1px solid #ddd; 
            margin: 10px 0; 
            border-radius: 5px;
        }
        .actions { margin-top: 10px; }
        .btn { 
            padding: 5px 10px; 
            margin-right: 5px; 
            text-decoration: none; 
            border-radius: 3px;
        }
        .btn-edit { background: #4CAF50; color: white; }
        .btn-delete { background: #f44336; color: white; }
        .btn-create { background: #2196F3; color: white; padding: 10px 15px; }
        .no-books { color: #666; font-style: italic; }
        .permission-denied { color: #f44336; padding: 10px; background: #ffebee; }
    </style>
</head>
<body>
    <h1>Book List</h1>
    
    <!-- CSRF token is not needed here since this is a GET page -->
    
    <!-- Create Book Button (only show if user has permission) -->
    {% if perms.bookshelf.can_create %}
    <div class="actions">
        <a href="{% url 'book_create' %}" class="btn btn-create">Create New Book</a>
    </div>
    {% endif %}

    <!-- Search Form -->
    <form method="get" action="{% url 'book_list' %}" style="margin: 20px 0;">
        <input type="text" name="q" placeholder="Search books..." value="{{ request.GET.q }}">
        <button type="submit">Search</button>
    </form>

    <!-- Book List -->
    <div class="book-list">
        {% if books %}
            {% for book in books %}
            <div class="book-item">
                <h3>{{ book.title }}</h3>
                <p><strong>Author:</strong> {{ book.author.name }}</p>
                
                <!-- Action Buttons -->
                <div class="actions">
                    <!-- Edit Button (only show if user has permission) -->
                    {% if perms.bookshelf.can_edit %}
                    <a href="{% url 'book_edit' book.id %}" class="btn btn-edit">Edit</a>
                    {% endif %}
                    
                    <!-- Delete Button (only show if user has permission) -->
                    {% if perms.bookshelf.can_delete %}
                    <a href="{% url 'book_delete' book.id %}" class="btn btn-delete">Delete</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="no-books">No books found.</p>
        {% endif %}
    </div>

    <!-- Security Features Demonstration -->
    <div style="margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 5px;">
        <h3>Security Features Implemented:</h3>
        <ul>
            <li>✅ Permission-based button visibility</li>
            <li>✅ Safe data display with template auto-escaping</li>
            <li>✅ Proper URL routing</li>
            <li>✅ CSRF protection on forms (in other templates)</li>
        </ul>
        
        <h4>Your Permissions:</h4>
        <ul>
            <li>Can View: {{ perms.bookshelf.can_view }}</li>
            <li>Can Create: {{ perms.bookshelf.can_create }}</li>
            <li>Can Edit: {{ perms.bookshelf.can_edit }}</li>
            <li>Can Delete: {{ perms.bookshelf.can_delete }}</li>
        </ul>
    </div>

    <!-- Navigation -->
    <div style="margin-top: 20px;">
        <a href="{% url 'form_example' %}">Go to Example Form</a> |
        <a href="{% url 'logout' %}">Logout</a>
    </div>
</body>
</html>